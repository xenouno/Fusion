{% block applyform %}
{% load static %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<div class="ui pointing secondary menu">
    <a class="active item" data-tab="assistantship">
        Assistantship Claim Form
    </a>
    <a class="item" data-tab="status">
        Status
    </a>
</div>

<div class="ui active tab" data-tab="assistantship">
    <div class="ui vertical segment">
       
        <form method="post" id="new_assistantshipclaim" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="ui form" style="padding: 8px; padding-left: 24px; padding-right: 24px;">
                <div class="two fields">
                    <div class="three wide field">
                        <label>Year</label>
                        <div class="ui selection dropdown">
                            <input type="hidden" name="year" id="ye" required/>
                            <i class="dropdown icon"></i>
                            <div class="default text">Select</div>
                            <div class="menu" required>
                                <div class="item" data-value="1">2023</div>
                                <div class="item" data-value="2">2024</div>
                            </div>
                        </div>
                    </div>
                    <div class="three wide field" style="margin-left: 300px">
                        <label>Month</label>
                        <div class="ui selection dropdown">
                            <input type="hidden" name="month" id="mo" required>
                            <i class="dropdown icon"></i>
                            <div class="default text">Select</div>
                            <div class="menu">
                                <div class="item" data-value="January">January</div>
                                <div class="item" data-value="February">February</div>
                                <div class="item" data-value="March">March</div>
                                <div class="item" data-value="April">April</div>
                                <div class="item" data-value="May">May</div>
                                <div class="item" data-value="June">June</div>
                                <div class="item" data-value="July">July</div>
                                <div class="item" data-value="August">August</div>
                                <div class="item" data-value="September">September</div>
                                <div class="item" data-value="October">October</div>
                                <div class="item" data-value="November">November</div>
                                <div class="item" data-value="December">December</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="one fields">
                    <div class="eight wide field">
                        <label for="bank">Bank Account Number</label>
                        <input type="text" name="bank_account" id="bank" required maxlength="11"/>
                    </div>
                </div>
                <div class="two fields">
                    <div class="eight wide field">
                        <label>Thesis Supervisor</label>
                        <input list="dropdown-menu3" name="thesis_supervisor" id="faculty_Search_thesis" type="text"/>
                        <datalist class="dropdown-menu" id="dropdown-menu3_thesis"></datalist>
                    </div>
                    <div class="eight wide field" style="margin-left: 185px">
                        <label>TA Supervisor</label>
                        <input list="dropdown-menu3" name="ta_supervisor" id="faculty_Search_ta" type="text"/>
                        <datalist class="dropdown-menu" id="dropdown-menu3_ta"></datalist>
                    </div>
                </div>
                <div class="eight wide field">
                    <label>Applicability</label>
                    <div class="ui selection dropdown">
                        <input type="hidden" name="applicability" required>
                        <i class="dropdown icon"></i>
                        <div class="default text">Select</div>
                        <div class="menu">
                            <div class="item" data-value="GATE">GATE</div>
                            <div class="item" data-value="CEED">CEED</div>
                            <div class="item" data-value="NET">NET</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="field">
                <button class="ui primary button right floated" type="submit" onclick="validateAssistantship('new_assistantshipclaim', event)">
                    Submit
                </button>
            </div>
        </form>
       
      
        <br>
        <br>
    </div>
    <br>
    <div class="extra content"></div>
</div>

<div class="ui tab" data-tab="status">
    <table class="ui celled table" style="padding-left: 2.5%; padding-right: 2.5%; padding-top: 1%; padding-bottom: 1.5%; width: 100%" id="stat">
        <thead>
            <tr style="border-radius: 3px;">
                <th rowspan="2">Month</th>
                <th rowspan="2">Year</th>
                <th rowspan="2">TA Supervisor</th>
                <th rowspan="2">Thesis Supervisor</th>
                <th rowspan="2">Academic department</th>
                <th rowspan="2">Account department</th>
            </tr>
        </thead>
        <tbody>
            {% for obj in assistantship_list reversed %}
            <tr id="statusid{{forloop.counter}}">
                <td>{{obj.month}}</td>
                <td>{{ obj.year }}</td>
                <td>
                    {% if obj.ta_supervisor_remark == True %}
                    <center><i class="ui green checkmark icon"></i></center>
                    {% elif obj.ta_supervisor_remark == False %}
                    <center><i class="ui orange hourglass half icon"></i></center>
                    {% endif %}
                </td>
                <td>
                    {% if obj.thesis_supervisor_remark == True %}
                    <center><i class="ui green checkmark icon"></i></center>
                    {% elif obj.thesis_supervisor_remark == False %}
                    <center><i class="ui orange hourglass half icon"></i></center>
                    {% endif %}
                </td>
                <td>
                    {% if obj.ta_supervisor_remark == False or obj.thesis_supervisor_remark == False %}
                    <center><strong>Not forwarded</strong></center>
                    {% elif obj.acad_approval == True %}
                    <center><i class="ui green checkmark icon"></i></center>
                    {% elif obj.acad_approval == False %}
                    <center><i class="ui orange hourglass half icon"></i></center>
                    {% endif %}
                </td>
                <td>
                    {% if obj.acad_approval == False %}
                    <center><strong>Not forwarded</strong></center>
                    {% elif obj.account_approval == True %}
                    <center><i class="ui green checkmark icon"></i></center>
                    {% elif obj.account_approval == False %}
                    <center><i class="ui orange hourglass half icon"></i></center>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<div hidden>
    <center><i class="ui orange hourglass half icon" id="hg"></i>
</div>

{% endblock %}

{% block javascript %}
<script>
    $(document).ready(function () {
        // Set the year dropdown menu
        var d = new Date();
        $("#1").html(d.getFullYear() - 1);
        $("#1").val(d.getFullYear() - 1);
        $("#2").html(d.getFullYear());
        $("#2").val(d.getFullYear());

        // AJAX for faculty search
        $('#faculty_Search_thesis, #faculty_Search_ta').on('input', function () {
            var current_value = $(this).val();
            var type = $(this).attr('id') === 'faculty_Search_thesis' ? 'thesis' : 'ta';
            $.ajax({
                type: 'POST',
                url: '/academic-procedures/faculty_data/',
                data: {
                    'current_value': current_value,
                    'type': type,
                },
                success: function (response) {
                    response = JSON.parse(response);
                    $('#dropdown-menu3_' + type).html('');
                    response.forEach(function (item) {
                        $('#dropdown-menu3_' + type).append('<option value="' + item + '">' + item + '</option>');
                    });
                },
                error: function (rs, e) {
                    console.log('error');
                },
            });
        });
    });

    function validateAssistantship(form, event) {
        event.preventDefault();
        var form = document.getElementById(form);
        var message = "";
        {% comment %} for (var i = 0; i < form.length; i++) {
            if (form.elements[i].name != "" && form.elements[i].value === "") {
                message = message + "<p><b>Please fill the " + form.elements[i].name + " field.</b></p>";
            } else if ((form.elements[i].name === "bank_account" && form.elements[i].value.length < 11)) {
                message = message + "<p><b>Please fill a valid " + form.elements[i].name + " field.</b></p>";
            }
        } {% endcomment %}
        if (message != "") {
            $("#errorContent").html(message);
            $(".formErrors").modal("show");
            return;
        }

        var formData = new FormData(form);
        $.ajax({
            url: '/academic-procedures/ACF/',
            data: formData,
            type: 'POST',
            contentType: false,
            processData: false,
            success: function (response) {
                response = JSON.parse(response);
                if (response.status == "success") {
                    $(".succ").modal("show");
                    var len = document.getElementById("stat").rows.length;
                    var table = document.getElementById("stat").getElementsByTagName('tbody')[0];
                    var row = table.insertRow(0);
                    row.insertCell().innerHTML = document.getElementById("mo").value;
                    row.insertCell().innerHTML = document.getElementById("ye").value;
                    row.insertCell().innerHTML = "<center><strong>Pending</strong></center>";
                    row.insertCell().innerHTML = "<center><strong>Pending</strong></center>";
                    row.insertCell().innerHTML = "<center><strong>Not forwarded</strong></center>";
                    row.insertCell().innerHTML = "<center><strong>Not forwarded</strong></center>";
                } else {
                    $("#errorContent").html('<p><b>' + response.message + '</p></b>');
                    $(".formErrors").modal('show');
                }
                form.reset();
            }
        });
    }
</script>
{% endblock %}